<!doctype html public "-//w3c//dtd html 4.0 transitional//en">
<html>
<head>
   <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
   <title>The Official FVWM Homepage - Fvwm-to-Module Communication</title>
</head>
<body text="white" bgcolor="black" link="#FFFF88" vlink="#EEDDDD" alink="#FF0000" background="black-stone1.jpg">

<h1 align="center"><font color="pink">
The Official FVWM Homepage - Fvwm-to-Module Communication
</font></h1>

<h2><font color="turquoise">
When communication takes place
</font></h2>
Fvwm can send messages to the modules in either a broadcast mode, or a
module specific mode. Certain messages regarding important window or desktop
manipulations are broadcast to all modules, whether they want it or not.
Modules are able to request information about current windows from fvwm,
via the Send_WindowList built-in. When invoked this way, only the requesting
module receives the data.

<h2><font color="turquoise">
Communication packet format
</font></h2>
Packets from fvwm to modules conform to a standard format, so modules which
are not interested in broadcast messages can easily ignore them. A header
consisting of 4 unsigned long integers, followed by a body of a variable
length make up a packet. The header always begins with 0xffffffff. This
is provided to help modules re-synchronize to the data stream if necessary.
The next entry describes the packet type. Existing packet types are listed
in the file libs/Module.h:
<p>
<table align="center" cellspacing=0 cellpadding=0>
<tr>
<td>#define <a href="#M_NEW_PAGE">M_NEW_PAGE</a></td>
<td>(1 &lt;&lt; 0)</td>
</tr><tr>
<td>#define <a href="#M_NEW_DESK">M_NEW_DESK</a></td>
<td>(1 &lt;&lt; 1)</td>
</tr><tr>
<td>#define M_OLD_ADD_WINDOW</td>
<td>(1 &lt;&lt; 2)</td>
</tr><tr>
<td>#define <a href="#M_RAISE_WINDOW">M_RAISE_WINDOW</a></td>
<td>(1 &lt;&lt; 3)</td>
</tr><tr>
<td>#define <a href="#M_LOWER_WINDOW">M_LOWER_WINDOW</a></td>
<td>(1 &lt;&lt; 4)</td>
</tr><tr>
<td>#define M_OLD_CONFIGURE_WINDOW</td>
<td>(1 &lt;&lt; 5)</td>
</tr><tr>
<td>#define <a href="#M_FOCUS_CHANGE">M_FOCUS_CHANGE</a></td>
<td>(1 &lt;&lt; 6)</td>
</tr><tr>
<td>#define <a href="#M_DESTROY_WINDOW">M_DESTROY_WINDOW</a></td>
<td>(1 &lt;&lt; 7)</td>
</tr><tr>
<td>#define <a href="#M_ICONIFY">M_ICONIFY</a></td>
<td>(1 &lt;&lt; 8)</td>
</tr><tr>
<td>#define <a href="#M_DEICONIFY">M_DEICONIFY</a></td>
<td>(1 &lt;&lt; 9)</td>
</tr><tr>
<td>#define <a href="#M_WINDOW_NAME">M_WINDOW_NAME</a></td>
<td>(1 &lt;&lt; 10)</td>
</tr><tr>
<td>#define <a href="#M_ICON_NAME">M_ICON_NAME</a></td>
<td>(1 &lt;&lt; 11)</td>
</tr><tr>
<td>#define <a href="#M_RES_CLASS">M_RES_CLASS</a></td>
<td>(1 &lt;&lt; 12)</td>
</tr><tr>
<td>#define <a href="#M_RES_NAME">M_RES_NAME</a></td>
<td>(1 &lt;&lt; 13)</td>
</tr><tr>
<td>#define <a href="#M_END_WINDOWLIST">M_END_WINDOWLIST</a></td>
<td>(1 &lt;&lt; 14)</td>
</tr><tr>
<td>#define <a href="#M_ICON_LOCATION">M_ICON_LOCATION</a></td>
<td>(1 &lt;&lt; 15)</td>
</tr><tr>
<td>#define <a href="#M_MAP">M_MAP</a></td>
<td>(1 &lt;&lt; 16)</td>
</tr><tr>
<td>#define <a href="#M_ERROR">M_ERROR</a></td>
<td>(1 &lt;&lt; 17)</td>
</tr><tr>
<td>#define <a href="#M_CONFIG_INFO">M_CONFIG_INFO</a></td>
<td>(1 &lt;&lt; 18)</td>
</tr><tr>
<td>#define <a href="#M_END_CONFIG_INFO">M_END_CONFIG_INFO</a></td>
<td>(1 &lt;&lt; 19)</td>
</tr><tr>
<td>#define <a href="#M_ICON_FILE">M_ICON_FILE</a></td>
<td>(1 &lt;&lt; 20)</td>
</tr><tr>
<td>#define <a href="#M_DEFAULTICON">M_DEFAULTICON</a></td>
<td>(1 &lt;&lt; 21)</td>
</tr><tr>
<td>#define <a href="#M_STRING">M_STRING</a></td>
<td>(1 &lt;&lt; 22)</td>
</tr><tr>
<td>#define <a href="#M_MINI_ICON">M_MINI_ICON</a></td>
<td>(1 &lt;&lt; 23)</td>
</tr><tr>
<td>#define <a href="#M_WINDOWSHADE">M_WINDOWSHADE</a></td>
<td>(1 &lt;&lt; 24)</td>
</tr><tr>
<td>#define <a href="#M_DEWINDOWSHADE">M_DEWINDOWSHADE</a></td>
<td>(1 &lt;&lt; 25)</td>
</tr><tr>
<td>&nbsp;</td>
<td>&nbsp;</td>
</tr><tr>
<td>#define <a href="#M_SENDCONFIG">M_SENDCONFIG</a></td>
<td>(1 &lt;&lt; 27)</td>
</tr><tr>
<td>#define <a href="#M_RESTACK">M_RESTACK</a></td>
<td>(1 &lt;&lt; 28)</td>
</tr><tr>
<td>#define <a href="#M_ADD_WINDOW">M_ADD_WINDOW</a></td>
<td>(1 &lt;&lt; 29)</td>
</tr><tr>
<td>#define <a href="#M_CONFIGURE_WINDOW">M_CONFIGURE_WINDOW</a></td>
<td>(1 &lt;&lt; 30)</td>
</tr>
</table>
<p>
Additional packet types will be defined in the future. The third entry
in the header tells the total length of the packet, in unsigned longs,
including the header. The fourth entry is the last time stamp received
from the X server, which is expressed in milliseconds.
<p>
The body information is packet specific, as described below.

<h2><a name="M_NEW_PAGE"></a>
M_NEW_PAGE
</h2>
These packets contain 5 integers. The first two are the x and y coordinates
of the upper left corner of the current viewport on the virtual desktop.
The third value is the number of the current desktop. The fourth and fifth
values are the maximum allowed values of the coordinates of the upper-left
hand corner of the viewport.

<h2><a name="M_NEW_DESK"></a>
M_NEW_DESK
</h2>
The body of this packet consists of a single long integer, whose value
is the number of the currently active desktop. This packet is transmitted
whenever the desktop number is changed.

<h2><a name="M_ADD_WINDOW"></a><a name="M_CONFIGURE_WINDOW"></a>
M_ADD_WINDOW, and M_CONFIGURE_WINDOW
</h2>
These packets contain 25 values.
The first value is the ID of the affected application's top level window,
the next is the ID of the Fvwm frame window, and the final value is the
pointer to Fvwm's internal database entry for that window. The
pointer itself is of no use to a module, it is there for backward
compatibilty with older modules.
The next 22 identify the location and size, as described in the table below.
Configure packets will be generated when the viewport on the current desktop
changes, or when the size or location of the window is changed. The flags
field is an bitwise OR of the flags defined in fvwm.h.
<p>
<table align="center" border>
<tr>
<td align="right">0</td>
<td>ID of the application's top level window</td>
</tr><tr>
<td align="right">1</td>
<td>ID of the Fvwm frame window</td>
</tr><tr>
<td align="right">2</td>
<td>Pointer to the Fvwm database entry (not useful)</td>
</tr><tr>
<td align="right">3</td>
<td>X location of the window's frame</td>
</tr><tr>
<td align="right">4</td>
<td>Y location of the window's frame</td>
</tr><tr>
<td align="right">5</td>
<td>Width of the window's frame</td>
</tr><tr>
<td align="right">6</td>
<td>Height of the window's frame</td>
</tr><tr>
<td align="right">7</td>
<td>Desktop number</td>
</tr><tr>
<td align="right">8</td>
<td>Layer number</td>
</tr><tr>
<td align="right">9</td>
<td>Window Title Height</td>
</tr><tr>
<td>10</td>
<td>Window Border Width</td>
</tr><tr>
<td>11</td>
<td>Window Base Width</td>
</tr><tr>
<td>12</td>
<td>Window Base Height</td>
</tr><tr>
<td>13</td>
<td>Window Resize Width Increment</td>
</tr><tr>
<td>14</td>
<td>Window Resize Height Increment</td>
</tr><tr>
<td>15</td>
<td>Window Minimum Width</td>
</tr><tr>
<td>16</td>
<td>Window Minimum Height</td>
</tr><tr>
<td>17</td>
<td>Window Maximum Width</td>
</tr><tr>
<td>18</td>
<td>Window Maximum Height</td>
</tr><tr>
<td>19</td>
<td>Icon Label Window ID, or 0</td>
</tr><tr>
<td>20</td>
<td>Icon Pixmap Window ID, or 0</td>
</tr><tr>
<td>21</td>
<td>Window Gravity</td>
</tr><tr>
<td>22</td>
<td>Pixel value of the text color</td>
</tr><tr>
<td>23</td>
<td>Pixel value of the window border color</td>
</tr><tr>
<td>24</td>
<td>Style flags</td>
</tr>
</table>

<h2>
<a name="M_LOWER_WINDOW"></a><a name="M_RAISE_WINDOW"></a><a name="M_DESTROY_WINDOW"></a>
M_LOWER_WINDOW, M_RAISE_WINDOW, and M_DESTROY_WINDOW
</h2>
These packets contain just the first three values of
<a href="#M_ADD_WINDOW">M_ADD_WINDOW</a>.

<h2>
<a name="M_FOCUS_CHANGE"></a>
M_FOCUS_CHANGE
</h2>
These packets contain 5 values, all of the same size as an unsigned long.
The first value is the ID of the affected application's (the application
which now has the input focus) top level window, the next is the ID of
the Fvwm frame window, and the third value is set to 0 when the focus change
is from the Focus command and 1 for all other focus changes (FlipFocus,
focusing with the mouse etc.). The third value can be used by the module
to manage the windowlist in the same way as Fvwm i.e. 0 means rotate the
list around to the target, 1 means pluck the target from the list and insert
at the beginning. The fourth and fifth values are the text focus color's
pixel value and the window border's focus color's pixel value. In the event
that the window which now has the focus is not a window which fvwm recognizes,
only the ID of the affected application's top level window is passed. Zeros
are passed for the other values.
<p>
<table align="center" border>
<tr>
<td align="right">0</td>
<td>ID of the application's top level window</td>
</tr><tr>
<td align="right">1</td>
<td>ID of the Fvwm frame window</td>
</tr><tr>
<td align="right">2</td>
<td>Focus change type</td>
</tr><tr>
<td align="right">3</td>
<td>Hilight text color</td>
</tr><tr>
<td align="right">4</td>
<td>Hilight background color</td>
</tr>
</table>

<h2>
<a name="M_ICON_LOCATION"></a>
M_ICON_LOCATION
</h2>
These packets contain 7 values. The first 3 are the same as
<a href="#M_ADD_WINDOW">M_ADD_WINDOW</a>,
and the next four describe the location and size of the icon,
as described in the table. An M_ICON_LOCATION packet will be sent when
an icon is created or moved and when the icon window is changed via the XA_WM_HINTS
in a property notify event.
<p>
<table align="center" border>
<tr>
<td>0</td>
<td>ID of the application's top level window</td>
</tr><tr>
<td>1</td>
<td>ID of the Fvwm frame window</td>
</tr><tr>
<td>2</td>
<td>Pointer to the Fvwm database entry (not useful)</td>
</tr><tr>
<td>3</td>
<td>X location of the icon</td>
</tr><tr>
<td>4</td>
<td>Y location of the icon</td>
</tr><tr>
<td>5</td>
<td>Width of the icon</td>
</tr><tr>
<td>6</td>
<td>Height of the icon</td>
</tr>
</table>

<h2>
<a name="M_ICONIFY"></a>
M_ICONIFY
</h2>
These packets contain 7 or 11 values. The first 3 are the same as
<a href="#M_ADD_WINDOW">M_ADD_WINDOW</a>, and the next 4 values describe
the location and size of the icon. If 4 further items are sent they are
the location and size of the window being iconified. Note that M_ICONIFY
packets are also sent whenever a window is started in the iconic state.
<p>
In addition, if a window which has transients is iconified,
then an M_ICONIFY packet is sent for each transient window, with the icon x and
y fields set to -10000. This packet will be sent even if
the transients were already iconified. Note that no icons are actually
generated for the transients in this case.
<p>
If a window has the NoIcon style the width and height of the icon window are
set to 0 and the location is meaningless.
<p>
<table align="center" border>
<tr>
<td align="right">0</td>
<td>ID of the application's top level window</td>
</tr><tr>
<td align="right">1</td>
<td>ID of the Fvwm frame window</td>
</tr><tr>
<td align="right">2</td>
<td>Pointer to the Fvwm database entry</td>
</tr><tr>
<td align="right">3</td>
<td>X location of the icon</td>
</tr><tr>
<td align="right">4</td>
<td>Y location of the icon</td>
</tr><tr>
<td align="right">5</td>
<td>Width of the icon</td>
</tr><tr>
<td align="right">6</td>
<td>Height of the icon</td>
</tr><tr>
<td align="right">7</td>
<td>X location of the window's frame</td>
</tr><tr>
<td align="right">8</td>
<td>Y location of the window's frame</td>
</tr><tr>
<td align="right">9</td>
<td>Width of the window's frame</td>
</tr><tr>
<td>10</td>
<td>Height of the window's frame</td>
</tr>
</table>

<h2>
<a name="M_DEICONIFY"></a>
M_DEICONIFY
</h2>
These packets contain up to 3, 7 or 11 values starting with the usual window identifiers.
The packet is sent when a window is de-iconified. Like M_ICONIFY icon and window
location and size are sent.

<h2>
<a name="M_MAP"></a>
M_MAP
</h2>
These packets contain 3 values, which are the usual window identifiers.
The packets are sent when a window is mapped, if it is not being deiconified.
This is useful to determine when a window is finally mapped, after being
added.

<h2>
<a name="M_WINDOW_NAME"></a><a name="M_ICON_NAME"></a><a name="M_RES_CLASS"></a><a name="M_RES_NAME"></a>
M_WINDOW_NAME, M_ICON_NAME, M_RES_CLASS and M_RES_NAME
</h2>
These packets contain 3 values, which are the usual window identifiers,
followed by a variable length character string. The packet size field in
the header is expressed in units of unsigned longs, and the packet is zero-padded
until it is the size of an unsigned long. The RES_CLASS and RES_NAME fields
are fields in the XClass structure for the window. Icon and Window name
packets will will be sent upon window creation or whenever the name is
changed. The RES_CLASS and RES_NAME packets are sent on window creation.
All packets are sent in response to a Send_WindowList request from a module.

<h2>
<a name="M_END_WINDOWLIST"></a>
M_END_WINDOWLIST
</h2>
These packets contain no values. This packet is sent to mark the end of
transmission in response to a Send_WindowList request. A module which requests
Send_WindowList, and processes all packets received between the request
and the M_END_WINDOWLIST will have a snapshot of the status of the desktop.

<h2>
<a name="M_ERROR"></a>
M_ERROR
</h2>
When fvwm has an error message to report, it is echoed to the modules in
a packet of this type. This packet has 3 values, all zero, followed by
a variable length string which contains the error message.

<h2>
<a name="M_CONFIG_INFO"></a>
M_CONFIG_INFO
</h2>
Fvwm records all configuration commands that it encounters which begins
with the character ``*''. When the built-in command ``Send_ConfigInfo''
is invoked by a module, this entire list is transmitted to the module in
packets (one line per packet) of this type. The packet consists of three
zeros, followed by a variable length character string. In addition, the
DeskTopSize, ImagePath, ColorLimit and Colorset definitions are sent to the module.
<p>Note that all the module configuration commands are sent. Each module
has to check the configuration commands to see if it is a command for that
specific module. This is actually a feature. This way one module can learn
about all other modules configurations. Also fvwm2 doesn't currently know
anything about module aliases.
<p>Starting with release 2.0.47, a module can set M_SENDCONFIG on in its
mask and receive M_CONFIG_INFO packets while it is running. (M_CONFIG_INFO
has to be on also.) A module can use M_SENDCONFIG to be able to change
configuration while it is running. Refer to module FvwmAnimate for an example.

<h2><a name="M_END_CONFIG_INFO"></a>
M_END_CONFIG_INFO
</h2>
After fvwm sends all of its M_CONFIG_INFO packets to a module, it sends
a packet of this type to indicate the end of the configuration information.
This packet contains no values. This packet it not sent for subsequent
config lines sent when the M_SENDCONFIG mask bit is on.

<h2>
<a name="M_ICON_FILE"></a>
M_ICON_FILE
</h2>
This packet is broadcast when a window is added or during send window list.
It is only sent for windows that have icons defined, and contains the usual 3
identifiers plus the filename of the icon.

<h2>
<a name="M_DEFAULTICON"></a>
M_DEFAULTICON
</h2>
This packet is sent during send window list. This is the icon associated
with Style "*". The packet contains the filename of the icon.

<h2>
<a name="M_STRING"></a>
M_STRING
</h2>
This packet is sent when a "SendToModule" command is processed. It contains the
usual 3 window identifiers (of the current window) plus the actual string.

<h2>
<a name="M_MINI_ICON"></a>
M_MINI_ICON
</h2>
This packet is broadcast when a window is added or during send window list.
It is only sent for windows that have mini_icons defined, and contains
the filename of the mini_icon. It contains the 3 window identifiers followed by
the width and height of the mini_icon, the depth (which is useless, it is always
the depth of the visual that fvwm is using), the window ID of the pixmap and mask,
and finally a string that is the path to the file (also not useful).

<h2>
<a name="M_WINDOWSHADE"></a><a name="M_DEWINDOWSHADE"></a>
M_WINDOWSHADE and M_DEWINDOWSHADE
</h2>
This packet is sent when a window is window shaded. It contains just the
window identifiers

<h2>
<a name="M_SENDCONFIG"></a>
M_SENDCONFIG</h2>
This is a dummy packet that is never sent by fvwm and is described under
<a href="mod_m2f_communication.html">Module to Fvwm communication</a>.
<h2>

<a name="M_RESTACK"></a>M_RESTACK</h2>
This packet is sent when the stacking order changes. It contains a list
of windows, each one being given by its three identifiers. The meaning
is that the first window keeps its position in the stacking order and all
subsequent windows are restacked below it (like XRestackWindows).
<p>
<hr>
</body>
</html>
